<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Price Ceiling Tutorial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        
        .dark {
            color-scheme: dark;
        }
        
        canvas {
            border-radius: 8px;
            background: white;
        }
        
        .dark canvas {
            background: #2d3748;
        }
        
        .btn-primary {
            background: #5D5CDE;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background: #4c4bcc;
            transform: translateY(-1px);
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .dark .card {
            background: #2d3748;
            border: 1px solid #4a5568;
        }
        
        .animate-bounce-gentle {
            animation: bounce-gentle 1s ease-in-out infinite;
        }
        
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- èªè¨€åˆ‡æ›æŒ‰éˆ• -->
        <div class="flex justify-end mb-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-1 flex">
                <button id="langCN" class="px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-primary text-white">
                    ä¸­æ–‡
                </button>
                <button id="langEN" class="px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                    English
                </button>
            </div>
        </div>

        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 id="mainTitle" class="text-3xl md:text-4xl font-bold mb-2 text-primary">åƒ¹æ ¼ä¸Šé™äº’å‹•æ•™å­¸</h1>
            <p id="mainSubtitle" class="text-lg text-gray-600 dark:text-gray-400">è§€å¯Ÿåƒ¹æ ¼ä¸Šé™æ”¿ç­–å°å¸‚å ´çš„å½±éŸ¿</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="lg:col-span-1">
                <div class="card p-6">
                    <h2 id="controlPanel" class="text-xl font-semibold mb-4 text-center">æ§åˆ¶é¢æ¿</h2>
                    
                    <!-- åƒ¹æ ¼ä¸Šé™èª¿æ•´ -->
                    <div class="mb-6">
                        <label id="priceCeilingAdjustment" class="block text-sm font-medium mb-3">åƒ¹æ ¼ä¸Šé™è¨­å®š</label>
                        <div class="space-y-3">
                            <button id="effectiveCeiling" class="bg-amber-700 hover:bg-amber-800 text-white px-4 py-2 rounded-lg w-full text-base font-medium transition-all duration-200">
                                æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™
                            </button>
                            <button id="ineffectiveCeiling" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg w-full text-base font-medium transition-all duration-200">
                                ç„¡æ•ˆçš„åƒ¹æ ¼ä¸Šé™
                            </button>
                            <button id="removeCeiling" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg w-full text-base font-medium transition-all duration-200">
                                é‡è¨­
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ–è¡¨å€åŸŸ -->
            <div class="lg:col-span-2">
                <div class="card p-6">
                    <div class="relative">
                        <canvas id="economicsChart" width="600" height="400" class="w-full max-w-full"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- äº’å‹•æ¸¬é©—å€åŸŸ -->
        <div class="mt-8 card p-6">
            <h2 class="text-xl font-semibold mb-6 text-center">ğŸ’­ äº’å‹•æ¸¬é©—</h2>
            
            <!-- Question 1 -->
            <div class="mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200" data-question-id="1">
                    å•é¡Œ 1ï¼šæœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™æœƒå°å¸‚å ´é€ æˆä»€éº¼å½±éŸ¿ï¼Ÿ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="1" data-answer="A">
                        <span class="font-medium text-primary">A.</span> <span class="option-text">é€ æˆå•†å“çŸ­ç¼º</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="1" data-answer="B">
                        <span class="font-medium text-primary">B.</span> <span class="option-text">é€ æˆå•†å“éå‰©</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="1" data-answer="C">
                        <span class="font-medium text-primary">C.</span> <span class="option-text">å°å¸‚å ´æ²’æœ‰å½±éŸ¿</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="1" data-answer="D">
                        <span class="font-medium text-primary">D.</span> <span class="option-text">æé«˜å¸‚å ´æ•ˆç‡</span>
                    </button>
                </div>
                <div id="feedback-1" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Question 2 -->
            <div class="mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200" data-question-id="2">
                    å•é¡Œ 2ï¼šä»€éº¼æƒ…æ³ä¸‹åƒ¹æ ¼ä¸Šé™æ˜¯ç„¡æ•ˆçš„ï¼Ÿ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="2" data-answer="A">
                        <span class="font-medium text-primary">A.</span> <span class="option-text">è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="2" data-answer="B">
                        <span class="font-medium text-primary">B.</span> <span class="option-text">è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Š</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="2" data-answer="C">
                        <span class="font-medium text-primary">C.</span> <span class="option-text">è¨­å®šç­‰æ–¼å‡è¡¡åƒ¹æ ¼</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="2" data-answer="D">
                        <span class="font-medium text-primary">D.</span> <span class="option-text">ç”±æ”¿åºœå¼·åˆ¶åŸ·è¡Œ</span>
                    </button>
                </div>
                <div id="feedback-2" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Question 3 -->
            <div class="mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200" data-question-id="3">
                    å•é¡Œ 3ï¼šåœ¨æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œå¯¦éš›äº¤æ˜“é‡ç”±ä»€éº¼æ±ºå®šï¼Ÿ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="3" data-answer="A">
                        <span class="font-medium text-primary">A.</span> <span class="option-text">éœ€æ±‚é‡</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="3" data-answer="B">
                        <span class="font-medium text-primary">B.</span> <span class="option-text">ä¾›çµ¦é‡</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="3" data-answer="C">
                        <span class="font-medium text-primary">C.</span> <span class="option-text">æ”¿åºœè¦å®š</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="3" data-answer="D">
                        <span class="font-medium text-primary">D.</span> <span class="option-text">å‡è¡¡æ•¸é‡</span>
                    </button>
                </div>
                <div id="feedback-3" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Question 4 -->
            <div class="mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200" data-question-id="4">
                    å•é¡Œ 4ï¼šç„¡æ•ˆåƒ¹æ ¼ä¸Šé™æ™‚ï¼Œå¯¦éš›äº¤æ˜“é‡æœƒç­‰æ–¼ä»€éº¼ï¼Ÿ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="4" data-answer="A">
                        <span class="font-medium text-primary">A.</span> <span class="option-text">éœ€æ±‚é‡</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="4" data-answer="B">
                        <span class="font-medium text-primary">B.</span> <span class="option-text">ä¾›çµ¦é‡</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="4" data-answer="C">
                        <span class="font-medium text-primary">C.</span> <span class="option-text">å‡è¡¡æ•¸é‡</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="4" data-answer="D">
                        <span class="font-medium text-primary">D.</span> <span class="option-text">ä»¥ä¸Šçš†æ˜¯</span>
                    </button>
                </div>
                <div id="feedback-4" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Question 5 -->
            <div class="mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200" data-question-id="5">
                    å•é¡Œ 5ï¼šåƒ¹æ ¼ä¸Šé™æ”¿ç­–é€šå¸¸ç”¨æ–¼å“ªç¨®æƒ…æ³ï¼Ÿ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="5" data-answer="A">
                        <span class="font-medium text-primary">A.</span> <span class="option-text">ä¿è­·æ¶ˆè²»è€…å…å—é«˜åƒ¹æ ¼å½±éŸ¿</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="5" data-answer="B">
                        <span class="font-medium text-primary">B.</span> <span class="option-text">ä¿è­·ç”Ÿç”¢è€…åˆ©ç›Š</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="5" data-answer="C">
                        <span class="font-medium text-primary">C.</span> <span class="option-text">å¢åŠ æ”¿åºœæ”¶å…¥</span>
                    </button>
                    <button class="quiz-option text-left p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200" 
                            data-question="5" data-answer="D">
                        <span class="font-medium text-primary">D.</span> <span class="option-text">æ¸›å°‘å¸‚å ´ç«¶çˆ­</span>
                    </button>
                </div>
                <div id="feedback-5" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>
        </div>

        <!-- èªªæ˜å€åŸŸ -->
        <div class="mt-8 card p-6">
            <h2 class="text-xl font-semibold mb-4">åƒ¹æ ¼ä¸Šé™æ”¿ç­–èªªæ˜</h2>
            
            <!-- äº’å‹•èªªæ˜ -->
            <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <h3 class="font-semibold text-blue-700 dark:text-blue-300 mb-2">ğŸ“± äº’å‹•åŠŸèƒ½</h3>
                <p class="text-sm text-blue-600 dark:text-blue-400">
                    é»æ“ŠæŒ‰éˆ•è¨­å®šä¸åŒçš„åƒ¹æ ¼ä¸Šé™æ°´æº–ï¼Œè§€å¯Ÿå…¶å°å¸‚å ´ä¾›éœ€çš„å½±éŸ¿ã€‚æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™æœƒé€ æˆçŸ­ç¼ºï¼Œç„¡æ•ˆåƒ¹æ ¼ä¸Šé™å‰‡ä¸å½±éŸ¿å¸‚å ´é‹ä½œï¼
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div>
                    <h3 class="font-semibold text-red-500 mb-2">æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™çš„å½±éŸ¿ï¼š</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400">
                        <li>è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹</li>
                        <li>é€ æˆå•†å“çŸ­ç¼ºï¼ˆéœ€æ±‚ > ä¾›çµ¦ï¼‰</li>
                        <li>å¯èƒ½å‡ºç¾é»‘å¸‚äº¤æ˜“</li>
                        <li>æ¶ˆè²»è€…éœ€è¦æ’éšŠæˆ–æŠ½ç±¤</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-green-500 mb-2">ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™çš„å½±éŸ¿ï¼š</h3>
                    <ul class="list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400">
                        <li>è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Š</li>
                        <li>å¸‚å ´ä»åœ¨å‡è¡¡é»é‹ä½œ</li>
                        <li>ä¸å½±éŸ¿å¯¦éš›äº¤æ˜“åƒ¹æ ¼</li>
                        <li>æ”¿ç­–å½¢åŒè™›è¨­</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼è¨­å®š
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // ç¶“æ¿Ÿå­¸åœ–è¡¨é¡
        class PriceCeilingChart {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // åƒ¹æ ¼ä¸Šé™è¨­å®š
                this.priceCeiling = null; // nullè¡¨ç¤ºæ²’æœ‰åƒ¹æ ¼ä¸Šé™
                this.ceilingType = null; // 'effective' or 'ineffective'
                
                // è¨­å®šåœ–è¡¨é‚Šè·
                this.margin = 60;
                this.chartWidth = this.width - 2 * this.margin;
                this.chartHeight = this.height - 2 * this.margin;
                
                // æ‹–å‹•ç›¸é—œç‹€æ…‹
                this.isDragging = false;
                this.isHovering = false;
                this.dragStartY = 0;
                this.initialCeilingPrice = 0;
                
                // é–ƒçˆæç¤ºç›¸é—œç‹€æ…‹
                this.showBlinkingTip = false;
                this.blinkingStartTime = 0;
                this.blinkingDuration = 3000; // 3ç§’
                
                this.setupEventListeners();
                this.setupInteractionListeners();
                this.draw();
            }
            
            setupEventListeners() {
                // éŸ¿æ‡‰å¼èª¿æ•´
                const resizeCanvas = () => {
                    const container = this.canvas.parentElement;
                    const rect = container.getBoundingClientRect();
                    
                    // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿè¨­å‚™
                    const isMobile = window.innerWidth <= 768;
                    const isPortrait = window.innerHeight > window.innerWidth;
                    
                    let scale;
                    if (isMobile && isPortrait) {
                        // æ‰‹æ©Ÿå‚ç›´æ¨¡å¼ï¼šä½¿ç”¨æ›´å¤§çš„æœ€å°ç¸®æ”¾æ¯”ä¾‹ï¼Œç¢ºä¿åœ–è¡¨è¶³å¤ å¤§
                        const containerScale = rect.width / 600;
                        scale = Math.max(containerScale, 0.95); // æœ€å°ç¸®æ”¾æ¯”ä¾‹ç‚º0.95ï¼ˆå¢å¤§35%ï¼‰
                        scale = Math.min(scale, 1.6); // æœ€å¤§ç¸®æ”¾æ¯”ä¾‹ç‚º1.6
                    } else {
                        // æ¡Œé¢æˆ–å¹³æ¿æ¨¡å¼ï¼šä½¿ç”¨åŸä¾†çš„é‚è¼¯
                        scale = Math.min(rect.width / 600, 1);
                    }
                    
                    this.canvas.style.transform = `scale(${scale})`;
                    this.canvas.style.transformOrigin = 'top left';
                    
                    // å‹•æ…‹èª¿æ•´å®¹å™¨é«˜åº¦ä»¥é©æ‡‰ç¸®æ”¾å¾Œçš„åœ–è¡¨
                    if (isMobile && isPortrait) {
                        const scaledHeight = 400 * scale;
                        container.style.height = `${scaledHeight}px`;
                        container.style.overflow = 'visible';
                    } else {
                        container.style.height = 'auto';
                        container.style.overflow = 'hidden';
                    }
                };
                
                window.addEventListener('resize', resizeCanvas);
                window.addEventListener('orientationchange', () => {
                    setTimeout(resizeCanvas, 100); // å»¶é²åŸ·è¡Œä»¥ç¢ºä¿orientationchangeå®Œæˆ
                });
                resizeCanvas();
            }
            
            // ä¾›çµ¦å‡½æ•¸ (å‘ä¸Šå‚¾æ–œ)
            supplyFunction(quantity) {
                return 5 + 0.05 * quantity;
            }
            
            // éœ€æ±‚å‡½æ•¸ (å‘ä¸‹å‚¾æ–œ)
            demandFunction(quantity) {
                return 15 - 0.05 * quantity;
            }
            
            // è¨ˆç®—å‡è¡¡é»
            calculateEquilibrium() {
                // æ±‚è§£ä¾›éœ€ç›¸ç­‰: 5 + 0.05 * Q = 15 - 0.05 * Q
                // 0.1 * Q = 10
                // Q = 100
                const equilibriumQuantity = 100;
                const equilibriumPrice = this.supplyFunction(equilibriumQuantity);
                
                return { quantity: equilibriumQuantity, price: equilibriumPrice };
            }
            
            // è¨ˆç®—åœ¨åƒ¹æ ¼ä¸Šé™ä¸‹çš„ä¾›éœ€é‡
            calculateCeilingEffect() {
                if (!this.priceCeiling) return null;
                
                // åœ¨åƒ¹æ ¼ä¸Šé™ä¸‹çš„ä¾›çµ¦é‡å’Œéœ€æ±‚é‡
                // ä¾›çµ¦å‡½æ•¸: P = 5 + 0.05Q => Q = (P - 5) / 0.05
                // éœ€æ±‚å‡½æ•¸: P = 15 - 0.05Q => Q = (15 - P) / 0.05
                
                const supplyQuantity = Math.max(0, (this.priceCeiling - 5) / 0.05);
                const demandQuantity = Math.max(0, (15 - this.priceCeiling) / 0.05);
                
                return {
                    supplyQuantity,
                    demandQuantity,
                    shortage: demandQuantity - supplyQuantity
                };
            }
            
            // åº§æ¨™è½‰æ›
            toCanvasX(quantity) {
                return this.margin + (quantity / 200) * this.chartWidth;
            }
            
            toCanvasY(price) {
                return this.height - this.margin - ((price - 0) / 20) * this.chartHeight;
            }
            
            draw() {
                // æ¸…é™¤ç•«å¸ƒ
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // è¨­å®šé¡è‰²ï¼ˆæ ¹æ“šæ·±è‰²æ¨¡å¼ï¼‰
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#e2e8f0' : '#374151';
                const gridColor = isDark ? '#4a5568' : '#d1d5db';
                const axisColor = isDark ? '#718096' : '#6b7280';
                
                // ç¹ªè£½åº§æ¨™è»¸
                this.drawAxes(textColor, axisColor);
                
                // ç¹ªè£½æ ¼ç·š
                this.drawGrid(gridColor);
                
                // ç¹ªè£½ä¾›çµ¦æ›²ç·š
                this.drawSupplyCurve();
                
                // ç¹ªè£½éœ€æ±‚æ›²ç·š
                this.drawDemandCurve();
                
                // ç¹ªè£½å‡è¡¡é»
                this.drawEquilibrium();
                
                // ç¹ªè£½åƒ¹æ ¼ä¸Šé™
                if (this.priceCeiling !== null) {
                    this.drawPriceCeiling();
                }
                
                // ç¹ªè£½é–ƒçˆæç¤º
                if (this.showBlinkingTip) {
                    this.drawBlinkingTip();
                }
            }
            
            drawAxes(textColor, axisColor) {
                this.ctx.strokeStyle = axisColor;
                this.ctx.lineWidth = 2;
                this.ctx.font = '14px Noto Sans TC';
                this.ctx.fillStyle = textColor;
                
                // Xè»¸
                this.ctx.beginPath();
                this.ctx.moveTo(this.margin, this.height - this.margin);
                this.ctx.lineTo(this.width - this.margin, this.height - this.margin);
                this.ctx.stroke();
                
                // Yè»¸
                this.ctx.beginPath();
                this.ctx.moveTo(this.margin, this.margin);
                this.ctx.lineTo(this.margin, this.height - this.margin);
                this.ctx.stroke();
                
                // è»¸æ¨™ç±¤ - æ ¹æ“šèªè¨€é¡¯ç¤º
                const quantityLabel = currentLanguage === 'cn' ? 'æ•¸é‡ (Quantity)' : 'Quantity';
                const priceLabel = currentLanguage === 'cn' ? 'åƒ¹æ ¼ (Price)' : 'Price';
                
                // Xè»¸æ¨™ç±¤æ”¾åœ¨å³æ–¹
                this.ctx.textAlign = 'center';
                this.ctx.fillText(quantityLabel, this.width - this.margin - 20, this.height - 20);
                
                // Yè»¸æ¨™ç±¤æ”¾åœ¨é ‚éƒ¨
                this.ctx.textAlign = 'left';
                this.ctx.fillText(priceLabel, 15, 25);
            }
            
            drawGrid(gridColor) {
                this.ctx.strokeStyle = gridColor;
                this.ctx.lineWidth = 0.3;
                
                // å‚ç›´ç·š (æ·¡åŒ–æ ¼ç·š)
                for (let q = 0; q <= 200; q += 50) {
                    const x = this.toCanvasX(q);
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, this.margin);
                    this.ctx.lineTo(x, this.height - this.margin);
                    this.ctx.stroke();
                }
                
                // æ°´å¹³ç·š (æ·¡åŒ–æ ¼ç·š)
                for (let p = 0; p <= 20; p += 5) {
                    const y = this.toCanvasY(p);
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.margin, y);
                    this.ctx.lineTo(this.width - this.margin, y);
                    this.ctx.stroke();
                }
            }
            
            drawSupplyCurve() {
                this.ctx.strokeStyle = '#ef4444';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                
                for (let q = 0; q <= 200; q += 1) {
                    const price = this.supplyFunction(q);
                    const x = this.toCanvasX(q);
                    const y = this.toCanvasY(price);
                    
                    if (q === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                
                this.ctx.stroke();
                
                // S æ¨™ç±¤ - æ”¾åœ¨æ›²ç·šæœ«ç«¯å³æ–¹ï¼Œç¨å¾®é«˜ä¸€é»
                const sEndQ = 190;
                const sEndPrice = this.supplyFunction(sEndQ);
                const sEndX = this.toCanvasX(sEndQ);
                const sEndY = this.toCanvasY(sEndPrice);
                
                this.ctx.fillStyle = '#ef4444';
                this.ctx.font = 'bold 18px Noto Sans TC';
                this.ctx.fillText('S', sEndX + 10, sEndY - 8);
            }
            
            drawDemandCurve() {
                this.ctx.strokeStyle = '#3b82f6';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                
                for (let q = 0; q <= 200; q += 1) {
                    const price = this.demandFunction(q);
                    if (price < 0) continue;
                    
                    const x = this.toCanvasX(q);
                    const y = this.toCanvasY(price);
                    
                    if (q === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                
                this.ctx.stroke();
                
                // D æ¨™ç±¤ (åœ¨æ›²ç·šæœ«ç«¯å³æ–¹)
                const dEndQ = 200;
                const dEndPrice = this.demandFunction(dEndQ);
                if (dEndPrice > 0) {
                    const dEndX = this.toCanvasX(dEndQ);
                    const dEndY = this.toCanvasY(dEndPrice);
                    
                    this.ctx.fillStyle = '#3b82f6';
                    this.ctx.font = 'bold 18px Noto Sans TC';
                    this.ctx.fillText('D', dEndX + 10, dEndY + 5);
                }
            }
            
            drawEquilibrium() {
                const eq = this.calculateEquilibrium();
                const eqX = this.toCanvasX(eq.quantity);
                const eqY = this.toCanvasY(eq.price);
                
                // ç¹ªè£½å‡è¡¡é»çš„è™›ç·šåˆ°åº§æ¨™è»¸
                this.ctx.strokeStyle = '#9ca3af';
                this.ctx.lineWidth = 1;
                this.ctx.setLineDash([4, 4]);
                
                // P* åˆ°Yè»¸çš„ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.margin, eqY);
                this.ctx.lineTo(eqX, eqY);
                this.ctx.stroke();
                
                // Q* åˆ°Xè»¸çš„ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(eqX, eqY);
                this.ctx.lineTo(eqX, this.height - this.margin);
                this.ctx.stroke();
                
                this.ctx.setLineDash([]);
                
                // ç¹ªè£½å‡è¡¡é»
                this.ctx.fillStyle = '#6b7280';
                this.ctx.strokeStyle = '#374151';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(eqX, eqY, 7, 0, 2 * Math.PI);
                this.ctx.fill();
                this.ctx.stroke();
                
                // P*, Q* æ¨™ç±¤
                this.ctx.font = 'bold 14px Noto Sans TC';
                this.ctx.fillStyle = '#9ca3af';
                this.ctx.fillText('P*', this.margin - 25, eqY + 4);
                this.ctx.fillText('Q*', eqX - 8, this.height - this.margin + 20);
            }
            
            drawPriceCeiling() {
                const ceilingY = this.toCanvasY(this.priceCeiling);
                const equilibrium = this.calculateEquilibrium();
                const ceilingEffect = this.calculateCeilingEffect();
                
                // ç¹ªè£½åƒ¹æ ¼ä¸Šé™ç·š
                if (this.ceilingType === 'effective') {
                    this.ctx.strokeStyle = '#92400e'; // æ£•è‰²å¯¦ç·š - æœ‰æ•ˆ
                    this.ctx.lineWidth = 4;
                    this.ctx.setLineDash([]); // å¯¦ç·š
                } else {
                    this.ctx.strokeStyle = '#16a34a'; // ç¶ è‰²è™›ç·š - ç„¡æ•ˆ
                    this.ctx.lineWidth = 4;
                    this.ctx.setLineDash([8, 8]); // è™›ç·š
                }
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.margin, ceilingY);
                this.ctx.lineTo(this.width - this.margin, ceilingY);
                this.ctx.stroke();
                
                this.ctx.setLineDash([]);
                
                // åƒ¹æ ¼ä¸Šé™æ¨™ç±¤ - æ ¹æ“šèªè¨€é¡¯ç¤º
                this.ctx.font = 'bold 16px Noto Sans TC';
                this.ctx.fillStyle = this.ceilingType === 'effective' ? '#92400e' : '#16a34a';
                const ceilingLabel = currentLanguage === 'cn' ? 'åƒ¹æ ¼ä¸Šé™' : 'Price Ceiling';
                this.ctx.fillText(ceilingLabel, this.width - this.margin - 100, ceilingY - 10);
                
                // åƒ¹æ ¼ä¸Šé™åœ¨Yè»¸é¡¯ç¤ºP1æ¨™ç±¤
                this.ctx.font = 'bold 14px Noto Sans TC';
                this.ctx.fillStyle = this.ceilingType === 'effective' ? '#92400e' : '#16a34a';
                this.ctx.fillText('P1', this.margin - 25, ceilingY + 4);
                
                // å¦‚æœæ˜¯æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ï¼Œé¡¯ç¤ºçŸ­ç¼ºæ•ˆæœ
                if (this.ceilingType === 'effective' && ceilingEffect) {
                    const supplyX = this.toCanvasX(ceilingEffect.supplyQuantity);
                    const demandX = this.toCanvasX(ceilingEffect.demandQuantity);
                    
                    // ç¹ªè£½ä¾›çµ¦é‡é»
                    this.ctx.fillStyle = '#ef4444';
                    this.ctx.strokeStyle = '#dc2626';
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    this.ctx.arc(supplyX, ceilingY, 6, 0, 2 * Math.PI);
                    this.ctx.fill();
                    this.ctx.stroke();
                    
                    // ç¹ªè£½éœ€æ±‚é‡é»
                    this.ctx.fillStyle = '#3b82f6';
                    this.ctx.strokeStyle = '#2563eb';
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    this.ctx.arc(demandX, ceilingY, 6, 0, 2 * Math.PI);
                    this.ctx.fill();
                    this.ctx.stroke();
                    
                    // ç¹ªè£½Qså’ŒQdåˆ°Xè»¸çš„è™›ç·š
                    this.ctx.strokeStyle = '#9ca3af';
                    this.ctx.lineWidth = 1;
                    this.ctx.setLineDash([4, 4]);
                    
                    // Qs åˆ°Xè»¸çš„è™›ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(supplyX, ceilingY);
                    this.ctx.lineTo(supplyX, this.height - this.margin);
                    this.ctx.stroke();
                    
                    // Qd åˆ°Xè»¸çš„è™›ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(demandX, ceilingY);
                    this.ctx.lineTo(demandX, this.height - this.margin);
                    this.ctx.stroke();
                    
                    this.ctx.setLineDash([]);
                    
                    // Qs å’Œ Qd æ¨™ç±¤
                    this.ctx.font = 'bold 12px Noto Sans TC';
                    this.ctx.fillStyle = '#dc2626';
                    this.ctx.fillText('Qs', supplyX - 8, this.height - this.margin + 15);
                    this.ctx.fillStyle = '#2563eb';
                    this.ctx.fillText('Qd', demandX - 8, this.height - this.margin + 15);
                    
                    // åœ¨Qså’ŒQdä¹‹é–“ç¹ªè£½é›™ç®­é ­ï¼ˆæ£•è‰²ï¼‰
                    const shortageMiddleX = (supplyX + demandX) / 2;
                    const arrowY = this.height - this.margin + 45;
                    
                    this.ctx.strokeStyle = '#92400e'; // æ£•è‰²
                    this.ctx.fillStyle = '#92400e'; // æ£•è‰²
                    this.ctx.lineWidth = 2;
                    
                    // ç¹ªè£½æ°´å¹³ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(supplyX + 10, arrowY);
                    this.ctx.lineTo(demandX - 10, arrowY);
                    this.ctx.stroke();
                    
                    // ç¹ªè£½å·¦ç®­é ­
                    this.ctx.beginPath();
                    this.ctx.moveTo(supplyX + 10, arrowY);
                    this.ctx.lineTo(supplyX + 18, arrowY - 4);
                    this.ctx.lineTo(supplyX + 18, arrowY + 4);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // ç¹ªè£½å³ç®­é ­
                    this.ctx.beginPath();
                    this.ctx.moveTo(demandX - 10, arrowY);
                    this.ctx.lineTo(demandX - 18, arrowY - 4);
                    this.ctx.lineTo(demandX - 18, arrowY + 4);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // åœ¨Qså’ŒQdä¹‹é–“é¡¯ç¤º"çŸ­ç¼º"ï¼ˆæ£•è‰²ï¼Œæ›´å¤§å­—é«”ï¼‰
                    this.ctx.font = 'bold 18px Noto Sans TC';
                    this.ctx.fillStyle = '#92400e'; // æ£•è‰²
                    this.ctx.textAlign = 'center';
                    const shortageText = currentLanguage === 'cn' ? 'çŸ­ç¼º' : 'Shortage';
                    this.ctx.fillText(shortageText, shortageMiddleX, this.height - this.margin + 50);
                    
                    // ç¹ªè£½æ©™è‰²ç®­é ­ï¼šå¾P*åˆ°P1
                    const eqPrice = this.calculateEquilibrium().price;
                    const eqY = this.toCanvasY(eqPrice);
                    const arrowStartY = eqY + 10;
                    const arrowEndY = ceilingY - 10;
                    const arrowX = this.margin - 40;
                    
                    this.ctx.strokeStyle = '#f97316'; // æ©™è‰²
                    this.ctx.fillStyle = '#f97316'; // æ©™è‰²
                    this.ctx.lineWidth = 2;
                    
                    // ç¹ªè£½å‚ç›´ç·šï¼ˆP*åˆ°P1ï¼‰
                    this.ctx.beginPath();
                    this.ctx.moveTo(arrowX, arrowStartY);
                    this.ctx.lineTo(arrowX, arrowEndY);
                    this.ctx.stroke();
                    
                    // ç¹ªè£½ç®­é ­é ­éƒ¨ï¼ˆå‘ä¸‹ï¼‰
                    this.ctx.beginPath();
                    this.ctx.moveTo(arrowX, arrowEndY);
                    this.ctx.lineTo(arrowX - 4, arrowEndY - 8);
                    this.ctx.lineTo(arrowX + 4, arrowEndY - 8);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // ç¹ªè£½æ©™è‰²ç®­é ­ï¼šå¾Q*åˆ°Qs
                    const eqQuantity = this.calculateEquilibrium().quantity;
                    const eqX = this.toCanvasX(eqQuantity);
                    const arrowStartX = eqX - 10;
                    const arrowEndX = supplyX + 10;
                    const arrowYpos = this.height - this.margin + 25;
                    
                    // ç¹ªè£½æ°´å¹³ç·šï¼ˆQ*åˆ°Qsï¼‰
                    this.ctx.beginPath();
                    this.ctx.moveTo(arrowStartX, arrowYpos);
                    this.ctx.lineTo(arrowEndX, arrowYpos);
                    this.ctx.stroke();
                    
                    // ç¹ªè£½ç®­é ­é ­éƒ¨ï¼ˆå‘å·¦ï¼‰
                    this.ctx.beginPath();
                    this.ctx.moveTo(arrowEndX, arrowYpos);
                    this.ctx.lineTo(arrowEndX + 8, arrowYpos - 4);
                    this.ctx.lineTo(arrowEndX + 8, arrowYpos + 4);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    this.ctx.textAlign = 'left';
                } else {
                    // å¦‚æœæ˜¯ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ï¼Œåœ¨ä¾›éœ€ç·šä¸Šé¡¯ç¤ºæŒ‡å‘å‡è¡¡é»çš„ä¸‰è§’ç®­é ­
                    const equilibrium = this.calculateEquilibrium();
                    const eqX = this.toCanvasX(equilibrium.quantity);
                    const eqY = this.toCanvasY(equilibrium.price);
                    
                    // è¨ˆç®—åƒ¹æ ¼ä¸Šé™ç·šèˆ‡ä¾›çµ¦ç·šå’Œéœ€æ±‚ç·šçš„äº¤é»
                    const ceilingPrice = this.priceCeiling;
                    
                    // ä¾›çµ¦ç·šåœ¨åƒ¹æ ¼ä¸Šé™è™•çš„æ•¸é‡
                    const supplyQuantityAtCeiling = Math.max(0, (ceilingPrice - 5) / 0.05);
                    const supplyX = this.toCanvasX(supplyQuantityAtCeiling);
                    
                    // éœ€æ±‚ç·šåœ¨åƒ¹æ ¼ä¸Šé™è™•çš„æ•¸é‡
                    const demandQuantityAtCeiling = Math.max(0, (15 - ceilingPrice) / 0.05);
                    const demandX = this.toCanvasX(demandQuantityAtCeiling);
                    
                    // åœ¨ä¾›çµ¦ç·šä¸Šç¹ªè£½ç´…è‰²ä¸‰è§’ç®­é ­æŒ‡å‘å‡è¡¡é»
                    this.ctx.fillStyle = '#ef4444'; // ç´…è‰²ï¼Œèˆ‡ä¾›çµ¦ç·šé¡è‰²ä¸€è‡´
                    
                    // è¨ˆç®—ä¾›çµ¦ç·šä¸Šç®­é ­çš„ä½ç½®ï¼ˆåœ¨åƒ¹æ ¼ä¸Šé™ç·šå’Œå‡è¡¡é»ä¹‹é–“ï¼‰
                    const supplyArrowX = (supplyX + eqX) / 2;
                    const supplyArrowY = (ceilingY + eqY) / 2;
                    
                    // è¨ˆç®—æŒ‡å‘å‡è¡¡é»çš„æ–¹å‘
                    const supplyDx = eqX - supplyArrowX;
                    const supplyDy = eqY - supplyArrowY;
                    const supplyAngle = Math.atan2(supplyDy, supplyDx);
                    
                    // ç¹ªè£½ä¾›çµ¦ç·šä¸Šçš„ç´…è‰²ä¸‰è§’ç®­é ­
                    const arrowSize = 12;
                    this.ctx.beginPath();
                    this.ctx.moveTo(
                        supplyArrowX + arrowSize * Math.cos(supplyAngle),
                        supplyArrowY + arrowSize * Math.sin(supplyAngle)
                    );
                    this.ctx.lineTo(
                        supplyArrowX + arrowSize * Math.cos(supplyAngle - 2.5),
                        supplyArrowY + arrowSize * Math.sin(supplyAngle - 2.5)
                    );
                    this.ctx.lineTo(
                        supplyArrowX + arrowSize * Math.cos(supplyAngle + 2.5),
                        supplyArrowY + arrowSize * Math.sin(supplyAngle + 2.5)
                    );
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // åœ¨éœ€æ±‚ç·šä¸Šç¹ªè£½è—è‰²ä¸‰è§’ç®­é ­æŒ‡å‘å‡è¡¡é»
                    this.ctx.fillStyle = '#3b82f6'; // è—è‰²ï¼Œèˆ‡éœ€æ±‚ç·šé¡è‰²ä¸€è‡´
                    
                    // è¨ˆç®—éœ€æ±‚ç·šä¸Šç®­é ­çš„ä½ç½®ï¼ˆåœ¨åƒ¹æ ¼ä¸Šé™ç·šå’Œå‡è¡¡é»ä¹‹é–“ï¼‰
                    const demandArrowX = (demandX + eqX) / 2;
                    const demandArrowY = (ceilingY + eqY) / 2;
                    
                    // è¨ˆç®—æŒ‡å‘å‡è¡¡é»çš„æ–¹å‘
                    const demandDx = eqX - demandArrowX;
                    const demandDy = eqY - demandArrowY;
                    const demandAngle = Math.atan2(demandDy, demandDx);
                    
                    // ç¹ªè£½éœ€æ±‚ç·šä¸Šçš„è—è‰²ä¸‰è§’ç®­é ­
                    this.ctx.beginPath();
                    this.ctx.moveTo(
                        demandArrowX + arrowSize * Math.cos(demandAngle),
                        demandArrowY + arrowSize * Math.sin(demandAngle)
                    );
                    this.ctx.lineTo(
                        demandArrowX + arrowSize * Math.cos(demandAngle - 2.5),
                        demandArrowY + arrowSize * Math.sin(demandAngle - 2.5)
                    );
                    this.ctx.lineTo(
                        demandArrowX + arrowSize * Math.cos(demandAngle + 2.5),
                        demandArrowY + arrowSize * Math.sin(demandAngle + 2.5)
                    );
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // æ·»åŠ æ–‡å­—èªªæ˜
                    this.ctx.font = 'bold 14px Noto Sans TC';
                    this.ctx.fillStyle = '#16a34a';
                    this.ctx.textAlign = 'center';
                    const equilibriumText = currentLanguage === 'cn' ? 'å›åˆ°å‡è¡¡' : 'Returns to Equilibrium';
                    this.ctx.fillText(equilibriumText, eqX, eqY - 20);
                    
                    this.ctx.textAlign = 'left';
                }
            }
            
            setEffectiveCeiling() {
                const equilibrium = this.calculateEquilibrium();
                this.priceCeiling = equilibrium.price - 2; // è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¸‹æ–¹
                this.ceilingType = 'effective';
                this.animateDraw();
            }
            
            setIneffectiveCeiling() {
                const equilibrium = this.calculateEquilibrium();
                this.priceCeiling = equilibrium.price + 2; // è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¸Šæ–¹
                this.ceilingType = 'ineffective';
                this.animateDraw();
            }
            
            removeCeiling() {
                this.priceCeiling = null;
                this.ceilingType = null;
                this.animateDraw();
            }
            
            animateDraw() {
                // ç°¡å–®çš„é‡ç¹ªå‹•ç•«
                this.canvas.style.transform += ' scale(1.02)';
                setTimeout(() => {
                    this.canvas.style.transform = this.canvas.style.transform.replace(' scale(1.02)', '');
                    this.draw();
                }, 100);
                
                this.draw();
            }
            
            // é¡¯ç¤ºé–ƒçˆæç¤º
            showDragTip() {
                if (this.priceCeiling !== null) {
                    this.showBlinkingTip = true;
                    this.blinkingStartTime = Date.now();
                    
                    // å•Ÿå‹•å‹•ç•«å¾ªç’°
                    this.animateBlinking();
                }
            }
            
            // é–ƒçˆå‹•ç•«å¾ªç’°
            animateBlinking() {
                if (!this.showBlinkingTip) return;
                
                // ç§»é™¤æ™‚é–“é™åˆ¶ï¼ŒæŒçºŒé–ƒçˆç›´åˆ°å­¸ç”Ÿæ‹–å‹•
                this.draw();
                
                if (this.showBlinkingTip) {
                    requestAnimationFrame(() => this.animateBlinking());
                }
            }
            
            // ç¹ªè£½é–ƒçˆæç¤º
            drawBlinkingTip() {
                if (!this.priceCeiling) return;
                
                const elapsed = Date.now() - this.blinkingStartTime;
                const cycle = 800; // é–ƒçˆé€±æœŸ 800ms
                const progress = (elapsed % cycle) / cycle;
                const opacity = 0.3 + 0.7 * Math.abs(Math.sin(progress * Math.PI * 2));
                
                const ceilingY = this.toCanvasY(this.priceCeiling);
                
                // æ ¹æ“šä¸Šé™é¡å‹é¸æ“‡é¡è‰² - æœ‰æ•ˆç”¨æ£•è‰²ï¼Œç„¡æ•ˆç”¨ç¶ è‰²
                const blinkColor = this.ceilingType === 'effective' ? '146, 64, 14' : '22, 163, 74';
                
                // ç¹ªè£½é–ƒçˆæ¡†
                this.ctx.strokeStyle = `rgba(${blinkColor}, ${opacity})`;
                this.ctx.lineWidth = 3;
                this.ctx.setLineDash([5, 5]);
                
                const boxMargin = 15;
                this.ctx.strokeRect(
                    this.margin - boxMargin,
                    ceilingY - boxMargin,
                    this.chartWidth + 2 * boxMargin,
                    2 * boxMargin
                );
                
                this.ctx.setLineDash([]);
                
                // ç¹ªè£½æç¤ºæ–‡å­—
                this.ctx.fillStyle = `rgba(${blinkColor}, ${opacity})`;
                this.ctx.font = 'bold 14px Noto Sans TC';
                this.ctx.textAlign = 'center';
                
                const tipText = currentLanguage === 'cn' ? 'æ‹–å‹•æ­¤ç·šæ¢èª¿æ•´åƒ¹æ ¼ä¸Šé™ â†•ï¸' : 'Drag this line to adjust price ceiling â†•ï¸';
                this.ctx.fillText(tipText, this.width / 2, ceilingY - 25);
                
                this.ctx.textAlign = 'left';
            }
            
            // è¨­ç½®æ‹–å‹•ç›£è½å™¨
            setupInteractionListeners() {
                // æ»‘é¼ äº‹ä»¶
                this.canvas.addEventListener('mousedown', (e) => this.handleStart(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.handleEnd(e));
                this.canvas.addEventListener('mouseleave', (e) => this.handleEnd(e));
                
                // è§¸æ§äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleStart(e.touches[0]);
                });
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleMove(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleEnd(e);
                });
                
                // æ”¹è®Šæ¸¸æ¨™æ¨£å¼
                this.canvas.addEventListener('mousemove', (e) => {
                    if (!this.isDragging) {
                        this.updateCursor(e);
                    }
                });
            }
            
            // ç²å–æ»‘é¼ /è§¸æ§ä½ç½®
            getEventPos(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }
            
            // æª¢æŸ¥æ˜¯å¦åœ¨åƒ¹æ ¼ä¸Šé™ç·šé™„è¿‘
            isNearPriceCeiling(pos) {
                if (this.priceCeiling === null) return false;
                
                const tolerance = 15; // å®¹è¨±çš„è·é›¢
                const ceilingY = this.toCanvasY(this.priceCeiling);
                
                // æª¢æŸ¥æ˜¯å¦åœ¨åœ–è¡¨ç¯„åœå…§
                if (pos.x < this.margin || pos.x > this.width - this.margin) return false;
                if (pos.y < this.margin || pos.y > this.height - this.margin) return false;
                
                // æª¢æŸ¥æ˜¯å¦åœ¨åƒ¹æ ¼ä¸Šé™ç·šé™„è¿‘
                return Math.abs(pos.y - ceilingY) < tolerance;
            }
            
            // è™•ç†é–‹å§‹æ‹–å‹•
            handleStart(e) {
                const pos = this.getEventPos(e);
                
                if (this.isNearPriceCeiling(pos)) {
                    this.isDragging = true;
                    this.dragStartY = pos.y;
                    this.initialCeilingPrice = this.priceCeiling;
                    this.canvas.style.cursor = 'grabbing';
                    
                    // å­¸ç”Ÿé–‹å§‹æ‹–å‹•æ™‚åœæ­¢é–ƒçˆæç¤º
                    this.showBlinkingTip = false;
                }
            }
            
            // è™•ç†æ‹–å‹•ç§»å‹•
            handleMove(e) {
                const pos = this.getEventPos(e);
                
                if (this.isDragging) {
                    // è¨ˆç®—å‚ç›´ç§»å‹•è·é›¢
                    const deltaY = this.dragStartY - pos.y; // å‘ä¸Šç‚ºæ­£
                    const priceChange = (deltaY / this.chartHeight) * 20; // è½‰æ›ç‚ºåƒ¹æ ¼å–®ä½
                    
                    // æ›´æ–°åƒ¹æ ¼ä¸Šé™ï¼Œé™åˆ¶åœ¨åˆç†ç¯„åœå…§ (1-19)
                    this.priceCeiling = Math.max(1, Math.min(19, this.initialCeilingPrice + priceChange));
                    
                    // æª¢æŸ¥æ˜¯å¦ä»ç‚ºæœ‰æ•ˆåƒ¹æ ¼ä¸Šé™
                    const equilibrium = this.calculateEquilibrium();
                    if (this.priceCeiling >= equilibrium.price) {
                        this.ceilingType = 'ineffective';
                    } else {
                        this.ceilingType = 'effective';
                    }
                    
                    // å¯¦æ™‚é‡ç¹ª
                    this.draw();
                }
            }
            
            // è™•ç†çµæŸæ‹–å‹•
            handleEnd(e) {
                if (this.isDragging) {
                    this.isDragging = false;
                    this.canvas.style.cursor = 'default';
                }
            }
            
            // æ›´æ–°æ¸¸æ¨™æ¨£å¼
            updateCursor(e) {
                const pos = this.getEventPos(e);
                
                if (this.isNearPriceCeiling(pos)) {
                    this.canvas.style.cursor = 'grab';
                    this.isHovering = true;
                } else {
                    this.canvas.style.cursor = 'default';
                    this.isHovering = false;
                }
            }
        }

        // èªè¨€åˆ‡æ›åŠŸèƒ½
        let currentLanguage = 'cn';
        
        const translations = {
            cn: {
                mainTitle: 'åƒ¹æ ¼ä¸Šé™äº’å‹•æ•™å­¸',
                mainSubtitle: 'è§€å¯Ÿåƒ¹æ ¼ä¸Šé™æ”¿ç­–å°å¸‚å ´çš„å½±éŸ¿',
                controlPanel: 'æ§åˆ¶é¢æ¿',
                priceCeilingAdjustment: 'åƒ¹æ ¼ä¸Šé™è¨­å®š',
                effectiveCeiling: 'æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™',
                ineffectiveCeiling: 'ç„¡æ•ˆçš„åƒ¹æ ¼ä¸Šé™',
                removeCeiling: 'é‡è¨­',
                chartTitle: 'åƒ¹æ ¼ä¸Šé™æ•ˆæœåœ–',
                interactiveQuiz: 'ğŸ’­ äº’å‹•æ¸¬é©—',
                conceptTitle: 'åƒ¹æ ¼ä¸Šé™æ”¿ç­–èªªæ˜',
                interactiveFeature: 'ğŸ“± äº’å‹•åŠŸèƒ½',
                interactiveDesc: 'é»æ“ŠæŒ‰éˆ•è¨­å®šä¸åŒçš„åƒ¹æ ¼ä¸Šé™æ°´æº–ï¼Œè§€å¯Ÿå…¶å°å¸‚å ´ä¾›éœ€çš„å½±éŸ¿ã€‚æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™æœƒé€ æˆçŸ­ç¼ºï¼Œç„¡æ•ˆåƒ¹æ ¼ä¸Šé™å‰‡ä¸å½±éŸ¿å¸‚å ´é‹ä½œï¼',
                effectiveCeilingTitle: 'æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™çš„å½±éŸ¿ï¼š',
                effectiveCeilingEffects: [
                    'è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹',
                    'é€ æˆå•†å“çŸ­ç¼ºï¼ˆéœ€æ±‚ > ä¾›çµ¦ï¼‰',
                    'å¯èƒ½å‡ºç¾é»‘å¸‚äº¤æ˜“',
                    'æ¶ˆè²»è€…éœ€è¦æ’éšŠæˆ–æŠ½ç±¤'
                ],
                ineffectiveCeilingTitle: 'ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™çš„å½±éŸ¿ï¼š',
                ineffectiveCeilingEffects: [
                    'è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Š',
                    'å¸‚å ´ä»åœ¨å‡è¡¡é»é‹ä½œ',
                    'ä¸å½±éŸ¿å¯¦éš›äº¤æ˜“åƒ¹æ ¼',
                    'æ”¿ç­–å½¢åŒè™›è¨­'
                ],
                questions: {
                    '1': {
                        text: 'å•é¡Œ 1ï¼šæœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™æœƒå°å¸‚å ´é€ æˆä»€éº¼å½±éŸ¿ï¼Ÿ',
                        options: {
                            'A': 'é€ æˆå•†å“çŸ­ç¼º',
                            'B': 'é€ æˆå•†å“éå‰©',
                            'C': 'å°å¸‚å ´æ²’æœ‰å½±éŸ¿',
                            'D': 'æé«˜å¸‚å ´æ•ˆç‡'
                        }
                    },
                    '2': {
                        text: 'å•é¡Œ 2ï¼šä»€éº¼æƒ…æ³ä¸‹åƒ¹æ ¼ä¸Šé™æ˜¯ç„¡æ•ˆçš„ï¼Ÿ',
                        options: {
                            'A': 'è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹',
                            'B': 'è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Š',
                            'C': 'è¨­å®šç­‰æ–¼å‡è¡¡åƒ¹æ ¼',
                            'D': 'ç”±æ”¿åºœå¼·åˆ¶åŸ·è¡Œ'
                        }
                    },
                    '3': {
                        text: 'å•é¡Œ 3ï¼šåœ¨æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œå¯¦éš›äº¤æ˜“é‡ç”±ä»€éº¼æ±ºå®šï¼Ÿ',
                        options: {
                            'A': 'éœ€æ±‚é‡',
                            'B': 'ä¾›çµ¦é‡',
                            'C': 'æ”¿åºœè¦å®š',
                            'D': 'å‡è¡¡æ•¸é‡'
                        }
                    },
                    '4': {
                        text: 'å•é¡Œ 4ï¼šç„¡æ•ˆåƒ¹æ ¼ä¸Šé™æ™‚ï¼Œå¯¦éš›äº¤æ˜“é‡æœƒç­‰æ–¼ä»€éº¼ï¼Ÿ',
                        options: {
                            'A': 'éœ€æ±‚é‡',
                            'B': 'ä¾›çµ¦é‡',
                            'C': 'å‡è¡¡æ•¸é‡',
                            'D': 'ä»¥ä¸Šçš†æ˜¯'
                        }
                    },
                    '5': {
                        text: 'å•é¡Œ 5ï¼šåƒ¹æ ¼ä¸Šé™æ”¿ç­–é€šå¸¸ç”¨æ–¼å“ªç¨®æƒ…æ³ï¼Ÿ',
                        options: {
                            'A': 'ä¿è­·æ¶ˆè²»è€…å…å—é«˜åƒ¹æ ¼å½±éŸ¿',
                            'B': 'ä¿è­·ç”Ÿç”¢è€…åˆ©ç›Š',
                            'C': 'å¢åŠ æ”¿åºœæ”¶å…¥',
                            'D': 'æ¸›å°‘å¸‚å ´ç«¶çˆ­'
                        }
                    }
                },
                explanations: {
                    '1': {
                        'A': 'âœ… æ­£ç¢ºï¼æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹ï¼Œæœƒä½¿éœ€æ±‚é‡å¤§æ–¼ä¾›çµ¦é‡ï¼Œé€ æˆå•†å“çŸ­ç¼ºã€‚',
                        'B': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™æœƒé™åˆ¶åƒ¹æ ¼ä¸Šå‡ï¼Œå°è‡´ä¾›çµ¦ä¸è¶³è€Œééå‰©ã€‚',
                        'C': 'âŒ éŒ¯èª¤ã€‚æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™æœƒæ˜é¡¯å½±éŸ¿å¸‚å ´é‹ä½œã€‚',
                        'D': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™é€šå¸¸æœƒé™ä½å¸‚å ´æ•ˆç‡ï¼Œé€ æˆè³‡æºé…ç½®ä¸ç•¶ã€‚'
                    },
                    '2': {
                        'A': 'âŒ éŒ¯èª¤ã€‚è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹çš„åƒ¹æ ¼ä¸Šé™æ˜¯æœ‰æ•ˆçš„ã€‚',
                        'B': 'âœ… æ­£ç¢ºï¼ç•¶åƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Šæ™‚ï¼Œå¸‚å ´åƒ¹æ ¼ä¸æœƒè§¸åŠä¸Šé™ï¼Œå› æ­¤æ”¿ç­–ç„¡æ•ˆã€‚',
                        'C': 'âŒ éŒ¯èª¤ã€‚è¨­å®šç­‰æ–¼å‡è¡¡åƒ¹æ ¼çš„ä¸Šé™è™•æ–¼è‡¨ç•Œç‹€æ…‹ã€‚',
                        'D': 'âŒ éŒ¯èª¤ã€‚æ”¿åºœåŸ·è¡ŒåŠ›åº¦ä¸å½±éŸ¿ä¸Šé™çš„æœ‰æ•ˆæ€§ï¼Œé—œéµåœ¨æ–¼è¨­å®šæ°´æº–ã€‚'
                    },
                    '3': {
                        'A': 'âŒ éŒ¯èª¤ã€‚é›–ç„¶éœ€æ±‚é‡è¼ƒé«˜ï¼Œä½†å¯¦éš›äº¤æ˜“å—ä¾›çµ¦é™åˆ¶ã€‚',
                        'B': 'âœ… æ­£ç¢ºï¼åœ¨æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œä¾›çµ¦é‡å°æ–¼éœ€æ±‚é‡ï¼Œå› æ­¤å¯¦éš›äº¤æ˜“é‡ç”±è¼ƒå°çš„ä¾›çµ¦é‡æ±ºå®šã€‚',
                        'C': 'âŒ éŒ¯èª¤ã€‚æ”¿åºœåªè¨­å®šåƒ¹æ ¼ä¸Šé™ï¼Œä¸ç›´æ¥æ±ºå®šäº¤æ˜“é‡ã€‚',
                        'D': 'âŒ éŒ¯èª¤ã€‚æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ç„¡æ³•é”åˆ°åŸå‡è¡¡æ•¸é‡ã€‚'
                    },
                    '4': {
                        'A': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼éœ€æ±‚é‡ï¼Œä¹Ÿç­‰æ–¼ä¾›çµ¦é‡å’Œå‡è¡¡æ•¸é‡ã€‚',
                        'B': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼ä¾›çµ¦é‡ï¼Œä¹Ÿç­‰æ–¼éœ€æ±‚é‡å’Œå‡è¡¡æ•¸é‡ã€‚',
                        'C': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼å‡è¡¡æ•¸é‡ï¼Œä¹Ÿç­‰æ–¼éœ€æ±‚é‡å’Œä¾›çµ¦é‡ã€‚',
                        'D': 'âœ… æ­£ç¢ºï¼ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Šæ™‚ï¼Œå¸‚å ´ä»åœ¨å‡è¡¡é»é‹ä½œï¼Œå› æ­¤éœ€æ±‚é‡=ä¾›çµ¦é‡=å‡è¡¡æ•¸é‡ï¼Œå¯¦éš›äº¤æ˜“ç­‰æ–¼ä¸‰è€…ã€‚'
                    },
                    '5': {
                        'A': 'âœ… æ­£ç¢ºï¼åƒ¹æ ¼ä¸Šé™æ”¿ç­–ä¸»è¦ç›®çš„æ˜¯ä¿è­·æ¶ˆè²»è€…ï¼Œé˜²æ­¢åƒ¹æ ¼éé«˜ï¼Œå¦‚æˆ¿ç§Ÿç®¡åˆ¶ã€åŸºæœ¬å•†å“åƒ¹æ ¼ç®¡åˆ¶ç­‰ã€‚',
                        'B': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™å°ç”Ÿç”¢è€…ä¸åˆ©ï¼Œæœƒå£“ä½ä»–å€‘çš„æ”¶å…¥ã€‚',
                        'C': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™ä¸æ˜¯ç‚ºäº†å¢åŠ æ”¿åºœæ”¶å…¥ã€‚',
                        'D': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™çš„ç›®çš„ä¸æ˜¯æ¸›å°‘ç«¶çˆ­ã€‚'
                    }
                }
            },
            en: {
                mainTitle: 'Interactive Price Ceiling Tutorial',
                mainSubtitle: 'Observe how price ceiling policies affect the market',
                controlPanel: 'Control Panel',
                priceCeilingAdjustment: 'Price Ceiling Settings',
                effectiveCeiling: 'Effective Price Ceiling',
                ineffectiveCeiling: 'Ineffective Price Ceiling',
                removeCeiling: 'Reset',
                chartTitle: 'Price Ceiling Effects Chart',
                interactiveQuiz: 'ğŸ’­ Interactive Quiz',
                conceptTitle: 'Price Ceiling Policy Explanation',
                interactiveFeature: 'ğŸ“± Interactive Features',
                interactiveDesc: 'Click buttons to set different price ceiling levels and observe their effects on market supply and demand. Effective price ceilings create shortages, while ineffective ones don\'t affect market operations!',
                effectiveCeilingTitle: 'Effects of Effective Price Ceiling:',
                effectiveCeilingEffects: [
                    'Set below equilibrium price',
                    'Creates shortage (demand > supply)',
                    'May lead to black market trading',
                    'Consumers need to queue or enter lotteries'
                ],
                ineffectiveCeilingTitle: 'Effects of Ineffective Price Ceiling:',
                ineffectiveCeilingEffects: [
                    'Set above equilibrium price',
                    'Market continues at equilibrium',
                    'No effect on actual trading price',
                    'Policy becomes meaningless'
                ],
                questions: {
                    '1': {
                        text: 'Question 1: What effect does an effective price ceiling have on the market?',
                        options: {
                            'A': 'Creates shortage',
                            'B': 'Creates surplus',
                            'C': 'No effect on market',
                            'D': 'Improves market efficiency'
                        }
                    },
                    '2': {
                        text: 'Question 2: When is a price ceiling ineffective?',
                        options: {
                            'A': 'Set below equilibrium price',
                            'B': 'Set above equilibrium price',
                            'C': 'Set equal to equilibrium price',
                            'D': 'Enforced by government'
                        }
                    },
                    '3': {
                        text: 'Question 3: Under an effective price ceiling, what determines actual trading quantity?',
                        options: {
                            'A': 'Quantity demanded',
                            'B': 'Quantity supplied',
                            'C': 'Government regulation',
                            'D': 'Equilibrium quantity'
                        }
                    },
                    '4': {
                        text: 'Question 4: Under an ineffective price ceiling, actual transactions equal what?',
                        options: {
                            'A': 'Quantity demanded',
                            'B': 'Quantity supplied',
                            'C': 'Equilibrium quantity',
                            'D': 'All of the above'
                        }
                    },
                    '5': {
                        text: 'Question 5: Price ceiling policies are typically used for what purpose?',
                        options: {
                            'A': 'Protect consumers from high prices',
                            'B': 'Protect producer interests',
                            'C': 'Increase government revenue',
                            'D': 'Reduce market competition'
                        }
                    }
                },
                explanations: {
                    '1': {
                        'A': 'âœ… Correct! An effective price ceiling set below equilibrium price causes quantity demanded to exceed quantity supplied, creating a shortage.',
                        'B': 'âŒ Incorrect. Price ceilings limit price increases, leading to insufficient supply rather than surplus.',
                        'C': 'âŒ Incorrect. Effective price ceilings significantly affect market operations.',
                        'D': 'âŒ Incorrect. Price ceilings typically reduce market efficiency and cause resource misallocation.'
                    },
                    '2': {
                        'A': 'âŒ Incorrect. A price ceiling set below equilibrium price is effective.',
                        'B': 'âœ… Correct! When a price ceiling is set above equilibrium price, market price won\'t reach the ceiling, making the policy ineffective.',
                        'C': 'âŒ Incorrect. A ceiling equal to equilibrium price is at the critical threshold.',
                        'D': 'âŒ Incorrect. Government enforcement doesn\'t affect ceiling effectiveness; the key is the setting level.'
                    },
                    '3': {
                        'A': 'âŒ Incorrect. Although quantity demanded is higher, actual trading is limited by supply.',
                        'B': 'âœ… Correct! Under an effective price ceiling, quantity supplied is less than quantity demanded, so actual trading quantity is determined by the smaller supply quantity.',
                        'C': 'âŒ Incorrect. Government only sets the price ceiling, not directly determining trading quantity.',
                        'D': 'âŒ Incorrect. Under effective price ceiling, original equilibrium quantity cannot be achieved.'
                    },
                    '4': {
                        'A': 'âŒ Incorrect. Under an ineffective price ceiling, transactions equal not only quantity demanded, but also quantity supplied and equilibrium quantity.',
                        'B': 'âŒ Incorrect. Under an ineffective price ceiling, transactions equal not only quantity supplied, but also quantity demanded and equilibrium quantity.',
                        'C': 'âŒ Incorrect. Under an ineffective price ceiling, transactions equal not only equilibrium quantity, but also quantity demanded and quantity supplied.',
                        'D': 'âœ… Correct! Under an ineffective price ceiling set above equilibrium price, the market continues to operate at equilibrium, so quantity demanded = quantity supplied = equilibrium quantity, and actual transactions equal all three.'
                    },
                    '5': {
                        'A': 'âœ… Correct! Price ceiling policies mainly aim to protect consumers by preventing excessively high prices, such as rent control and basic commodity price controls.',
                        'B': 'âŒ Incorrect. Price ceilings disadvantage producers by reducing their income.',
                        'C': 'âŒ Incorrect. Price ceilings are not designed to increase government revenue.',
                        'D': 'âŒ Incorrect. The purpose of price ceilings is not to reduce competition.'
                    }
                }
            }
        };
        
        function updateLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            
            // æ›´æ–°ä¸»è¦å…§å®¹
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('mainSubtitle').textContent = t.mainSubtitle;
            
            // æ›´æ–°æ§åˆ¶é¢æ¿
            updateTextContent('controlPanel', t.controlPanel);
            updateTextContent('priceCeilingAdjustment', t.priceCeilingAdjustment);
            updateButtonText('effectiveCeiling', t.effectiveCeiling);
            updateButtonText('ineffectiveCeiling', t.ineffectiveCeiling);
            updateButtonText('removeCeiling', t.removeCeiling);
            
            // æ›´æ–°åœ–è¡¨æ¨™é¡Œ
            updateTextContent('chartTitle', t.chartTitle);
            
            // æ›´æ–°æ¸¬é©—æ¨™é¡Œ
            const quizTitle = document.querySelector('.mt-8.card h2');
            if (quizTitle) quizTitle.textContent = t.interactiveQuiz;
            
            // æ›´æ–°èªªæ˜å€åŸŸ
            const conceptTitle = document.querySelector('.mt-8.card:last-child h2');
            if (conceptTitle) conceptTitle.textContent = t.conceptTitle;
            
            const interactiveFeatureTitle = document.querySelector('.bg-blue-50 h3');
            if (interactiveFeatureTitle) interactiveFeatureTitle.textContent = t.interactiveFeature;
            
            const interactiveDesc = document.querySelector('.bg-blue-50 p');
            if (interactiveDesc) interactiveDesc.textContent = t.interactiveDesc;
            
            // æ›´æ–°åƒ¹æ ¼ä¸Šé™å½±éŸ¿æ¨™é¡Œå’Œåˆ—è¡¨
            const ceilingTitles = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2 h3');
            if (ceilingTitles[0]) ceilingTitles[0].textContent = t.effectiveCeilingTitle;
            if (ceilingTitles[1]) ceilingTitles[1].textContent = t.ineffectiveCeilingTitle;
            
            const ceilingLists = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-2 ul');
            if (ceilingLists[0]) {
                ceilingLists[0].innerHTML = t.effectiveCeilingEffects.map(item => `<li>${item}</li>`).join('');
            }
            if (ceilingLists[1]) {
                ceilingLists[1].innerHTML = t.ineffectiveCeilingEffects.map(item => `<li>${item}</li>`).join('');
            }
            
            // æ›´æ–°å•é¡Œå’Œé¸é …
            updateQuestions(t.questions);
            
            // æ›´æ–°ç•¶å‰èªè¨€çš„è§£é‡‹ï¼ˆçµ¦æ¸¬é©—ç³»çµ±ä½¿ç”¨ï¼‰
            window.currentExplanations = t.explanations;
            
            // é‡æ–°ç¹ªè£½åœ–è¡¨ï¼ˆæ›´æ–°è»¸æ¨™ç±¤ï¼‰
            if (window.chart) {
                window.chart.draw();
            }
        }
        
        function updateTextContent(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }
        
        function updateButtonText(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }
        
        function updateQuestions(questions) {
            Object.keys(questions).forEach(questionId => {
                const questionData = questions[questionId];
                
                // æ›´æ–°å•é¡Œæ–‡æœ¬
                const questionElement = document.querySelector(`[data-question-id="${questionId}"]`);
                if (questionElement) {
                    questionElement.textContent = questionData.text;
                }
                
                // æ›´æ–°é¸é …
                Object.keys(questionData.options).forEach(optionKey => {
                    const optionElement = document.querySelector(`[data-question="${questionId}"][data-answer="${optionKey}"] .option-text`);
                    if (optionElement) {
                        optionElement.textContent = questionData.options[optionKey];
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            const chart = new PriceCeilingChart('economicsChart');
            window.chart = chart; // ä¿å­˜åœ–è¡¨å¯¦ä¾‹ä¾›èªè¨€åˆ‡æ›ä½¿ç”¨
            
            // èªè¨€åˆ‡æ›æŒ‰éˆ•äº‹ä»¶
            document.getElementById('langCN').addEventListener('click', () => {
                updateLanguage('cn');
                document.getElementById('langCN').className = 'px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-primary text-white';
                document.getElementById('langEN').className = 'px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700';
            });
            
            document.getElementById('langEN').addEventListener('click', () => {
                updateLanguage('en');
                document.getElementById('langEN').className = 'px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-primary text-white';
                document.getElementById('langCN').className = 'px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700';
            });
            
            // æŒ‰éˆ•äº‹ä»¶
            document.getElementById('effectiveCeiling').addEventListener('click', () => {
                chart.setEffectiveCeiling();
                setTimeout(() => chart.showDragTip(), 500); // å»¶é²0.5ç§’é¡¯ç¤ºæç¤º
            });
            
            document.getElementById('ineffectiveCeiling').addEventListener('click', () => {
                chart.setIneffectiveCeiling();
                setTimeout(() => chart.showDragTip(), 500); // å»¶é²0.5ç§’é¡¯ç¤ºæç¤º
            });
            
            document.getElementById('removeCeiling').addEventListener('click', () => {
                chart.removeCeiling();
            });
            
            // æ¸¬é©—åŠŸèƒ½
            setupQuiz();
        });
        
        // è¨­ç½®æ¸¬é©—åŠŸèƒ½
        function setupQuiz() {
            const quizOptions = document.querySelectorAll('.quiz-option');
            
            // æ­£ç¢ºç­”æ¡ˆ
            const correctAnswers = {
                '1': 'A', // æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™é€ æˆçŸ­ç¼º
                '2': 'B', // è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Šæ™‚ç„¡æ•ˆ
                '3': 'B', // å¯¦éš›äº¤æ˜“é‡ç”±ä¾›çµ¦é‡æ±ºå®š
                '4': 'D', // ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™æ™‚äº¤æ˜“ç­‰æ–¼éœ€æ±‚é‡ã€ä¾›çµ¦é‡ã€å‡è¡¡æ•¸é‡ï¼ˆä»¥ä¸Šçš†æ˜¯ï¼‰
                '5': 'A'  // ä¿è­·æ¶ˆè²»è€…å…å—é«˜åƒ¹æ ¼å½±éŸ¿
            };
            
            // ç­”æ¡ˆè§£é‡‹
            const explanations = {
                '1': {
                    'A': 'âœ… æ­£ç¢ºï¼æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹ï¼Œæœƒä½¿éœ€æ±‚é‡å¤§æ–¼ä¾›çµ¦é‡ï¼Œé€ æˆå•†å“çŸ­ç¼ºã€‚',
                    'B': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™æœƒé™åˆ¶åƒ¹æ ¼ä¸Šå‡ï¼Œå°è‡´ä¾›çµ¦ä¸è¶³è€Œééå‰©ã€‚',
                    'C': 'âŒ éŒ¯èª¤ã€‚æœ‰æ•ˆçš„åƒ¹æ ¼ä¸Šé™æœƒæ˜é¡¯å½±éŸ¿å¸‚å ´é‹ä½œã€‚',
                    'D': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™é€šå¸¸æœƒé™ä½å¸‚å ´æ•ˆç‡ï¼Œé€ æˆè³‡æºé…ç½®ä¸ç•¶ã€‚'
                },
                '2': {
                    'A': 'âŒ éŒ¯èª¤ã€‚è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸‹çš„åƒ¹æ ¼ä¸Šé™æ˜¯æœ‰æ•ˆçš„ã€‚',
                    'B': 'âœ… æ­£ç¢ºï¼ç•¶åƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Šæ™‚ï¼Œå¸‚å ´åƒ¹æ ¼ä¸æœƒè§¸åŠä¸Šé™ï¼Œå› æ­¤æ”¿ç­–ç„¡æ•ˆã€‚',
                    'C': 'âŒ éŒ¯èª¤ã€‚è¨­å®šç­‰æ–¼å‡è¡¡åƒ¹æ ¼çš„ä¸Šé™è™•æ–¼è‡¨ç•Œç‹€æ…‹ã€‚',
                    'D': 'âŒ éŒ¯èª¤ã€‚æ”¿åºœåŸ·è¡ŒåŠ›åº¦ä¸å½±éŸ¿ä¸Šé™çš„æœ‰æ•ˆæ€§ï¼Œé—œéµåœ¨æ–¼è¨­å®šæ°´æº–ã€‚'
                },
                '3': {
                    'A': 'âŒ éŒ¯èª¤ã€‚é›–ç„¶éœ€æ±‚é‡è¼ƒé«˜ï¼Œä½†å¯¦éš›äº¤æ˜“å—ä¾›çµ¦é™åˆ¶ã€‚',
                    'B': 'âœ… æ­£ç¢ºï¼åœ¨æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œä¾›çµ¦é‡å°æ–¼éœ€æ±‚é‡ï¼Œå› æ­¤å¯¦éš›äº¤æ˜“é‡ç”±è¼ƒå°çš„ä¾›çµ¦é‡æ±ºå®šã€‚',
                    'C': 'âŒ éŒ¯èª¤ã€‚æ”¿åºœåªè¨­å®šåƒ¹æ ¼ä¸Šé™ï¼Œä¸ç›´æ¥æ±ºå®šäº¤æ˜“é‡ã€‚',
                    'D': 'âŒ éŒ¯èª¤ã€‚æœ‰æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ç„¡æ³•é”åˆ°åŸå‡è¡¡æ•¸é‡ã€‚'
                },
                '4': {
                    'A': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼éœ€æ±‚é‡ï¼Œä¹Ÿç­‰æ–¼ä¾›çµ¦é‡å’Œå‡è¡¡æ•¸é‡ã€‚',
                    'B': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼ä¾›çµ¦é‡ï¼Œä¹Ÿç­‰æ–¼éœ€æ±‚é‡å’Œå‡è¡¡æ•¸é‡ã€‚',
                    'C': 'âŒ éŒ¯èª¤ã€‚åœ¨ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™ä¸‹ï¼Œäº¤æ˜“ä¸åƒ…ç­‰æ–¼å‡è¡¡æ•¸é‡ï¼Œä¹Ÿç­‰æ–¼éœ€æ±‚é‡å’Œä¾›çµ¦é‡ã€‚',
                    'D': 'âœ… æ­£ç¢ºï¼ç„¡æ•ˆåƒ¹æ ¼ä¸Šé™è¨­å®šåœ¨å‡è¡¡åƒ¹æ ¼ä¹‹ä¸Šæ™‚ï¼Œå¸‚å ´ä»åœ¨å‡è¡¡é»é‹ä½œï¼Œå› æ­¤éœ€æ±‚é‡=ä¾›çµ¦é‡=å‡è¡¡æ•¸é‡ï¼Œå¯¦éš›äº¤æ˜“ç­‰æ–¼ä¸‰è€…ã€‚'
                },
                '5': {
                    'A': 'âœ… æ­£ç¢ºï¼åƒ¹æ ¼ä¸Šé™æ”¿ç­–ä¸»è¦ç›®çš„æ˜¯ä¿è­·æ¶ˆè²»è€…ï¼Œé˜²æ­¢åƒ¹æ ¼éé«˜ï¼Œå¦‚æˆ¿ç§Ÿç®¡åˆ¶ã€åŸºæœ¬å•†å“åƒ¹æ ¼ç®¡åˆ¶ç­‰ã€‚',
                    'B': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™å°ç”Ÿç”¢è€…ä¸åˆ©ï¼Œæœƒå£“ä½ä»–å€‘çš„æ”¶å…¥ã€‚',
                    'C': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™ä¸æ˜¯ç‚ºäº†å¢åŠ æ”¿åºœæ”¶å…¥ã€‚',
                    'D': 'âŒ éŒ¯èª¤ã€‚åƒ¹æ ¼ä¸Šé™çš„ç›®çš„ä¸æ˜¯æ¸›å°‘ç«¶çˆ­ã€‚'
                }
            };
            
            quizOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const question = this.dataset.question;
                    const answer = this.dataset.answer;
                    const feedback = document.getElementById(`feedback-${question}`);
                    
                    // ç§»é™¤æ‰€æœ‰åŒçµ„é¸é …çš„é¸ä¸­ç‹€æ…‹
                    const sameGroupOptions = document.querySelectorAll(`[data-question="${question}"]`);
                    sameGroupOptions.forEach(opt => {
                        opt.classList.remove('border-green-500', 'border-red-500', 'bg-green-50', 'bg-red-50');
                        opt.classList.remove('dark:bg-green-900/20', 'dark:bg-red-900/20');
                        opt.classList.add('border-gray-200', 'dark:border-gray-600');
                    });
                    
                    // æ¨™è¨˜ç•¶å‰é¸é …
                    const isCorrect = answer === correctAnswers[question];
                    if (isCorrect) {
                        this.classList.remove('border-gray-200', 'dark:border-gray-600');
                        this.classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20');
                    } else {
                        this.classList.remove('border-gray-200', 'dark:border-gray-600');
                        this.classList.add('border-red-500', 'bg-red-50', 'dark:bg-red-900/20');
                        
                        // åŒæ™‚æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
                        const correctOption = document.querySelector(`[data-question="${question}"][data-answer="${correctAnswers[question]}"]`);
                        correctOption.classList.remove('border-gray-200', 'dark:border-gray-600');
                        correctOption.classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20');
                    }
                    
                    // é¡¯ç¤ºåé¥‹ï¼ˆä½¿ç”¨ç•¶å‰èªè¨€çš„è§£é‡‹ï¼‰
                    const currentExplanations = window.currentExplanations || explanations;
                    feedback.className = `mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700' : 'bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700'}`;
                    feedback.innerHTML = `<p class="${isCorrect ? 'text-green-800 dark:text-green-300' : 'text-red-800 dark:text-red-300'}">${currentExplanations[question][answer]}</p>`;
                    feedback.classList.remove('hidden');
                    
                    // å¹³æ»‘æ»¾å‹•åˆ°åé¥‹
                    feedback.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
            });
        }
    </script>
</body>
</html>
